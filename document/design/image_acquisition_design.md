# ç”»åƒå–å¾—æ©Ÿèƒ½ è¨­è¨ˆæ›¸

## ğŸ“‹ è¦ä»¶å®šç¾©

### ğŸ¯ åŸºæœ¬è¦ä»¶

#### 1. mainCollectorã§ã®ç”»åƒå–å¾—
- **å¯¾è±¡**: ç‰©ä»¶ä¸€è¦§ãƒšãƒ¼ã‚¸ã®å„ç‰©ä»¶
- **å–å¾—æšæ•°**: 3æš/ç‰©ä»¶
- **å‡¦ç†ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ç‰©ä»¶ä¸€è¦§ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æ™‚
- **ä¿å­˜å¯¾è±¡**: åŸºæœ¬çš„ãªç‰©ä»¶ç”»åƒï¼ˆã‚µãƒ ãƒã‚¤ãƒ«å“è³ªï¼‰

#### 2. ç‰¹å®šç‰©ä»¶ã®è©³ç´°ç”»åƒå–å¾—
- **å¯¾è±¡**: ã€Œç‰¹å®šç‰©ä»¶ä¸€è¦§ã€ã«ç™»éŒ²ã•ã‚ŒãŸç‰©ä»¶
- **å–å¾—å ´æ‰€**: detailCollectorï¼ˆç‰©ä»¶è©³ç´°ãƒšãƒ¼ã‚¸ï¼‰
- **å–å¾—æšæ•°**: è©³ç´°ãƒšãƒ¼ã‚¸å†…ã®å…¨ç”»åƒï¼ˆé€šå¸¸10-20æšï¼‰
- **ä¿å­˜å¯¾è±¡**: é«˜å“è³ªãªè©³ç´°ç”»åƒ

### ğŸ’¡ è¿½åŠ æ¨å¥¨è¦ä»¶

#### 3. ç”»åƒå“è³ªãƒ»ã‚µã‚¤ã‚ºç®¡ç†
- **ç”»åƒå½¢å¼**: JPEGå„ªå…ˆï¼ˆPNG, WebPå¯¾å¿œï¼‰
- **å“è³ªè¨­å®š**: JPEGå“è³ª75%ã§çµ±ä¸€
- **ã‚µã‚¤ã‚ºåˆ¶é™**: 1ç”»åƒã‚ãŸã‚Šæœ€å¤§10MB
- **ãƒªã‚µã‚¤ã‚º**: å¿…è¦ã«å¿œã˜ã¦è‡ªå‹•ãƒªã‚µã‚¤ã‚º
  - ã‚µãƒ ãƒã‚¤ãƒ«: 320Ã—240px
  - é€šå¸¸ç”»åƒ: 640Ã—480pxï¼ˆä¸€è¦§ãƒšãƒ¼ã‚¸ï¼‰
  - é«˜è§£åƒåº¦: 1024Ã—768pxï¼ˆè©³ç´°ãƒšãƒ¼ã‚¸ï¼‰

#### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ä¿¡é ¼æ€§
- **ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚ã«3å›ã¾ã§å†è©¦è¡Œ
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 1ç”»åƒã‚ãŸã‚Š30ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- **ä¸æ­£ç”»åƒ**: ç ´æç”»åƒã®æ¤œå‡ºãƒ»ã‚¹ã‚­ãƒƒãƒ—
- **ç¶™ç¶šæ€§**: ä¸€éƒ¨ç”»åƒã®å¤±æ•—æ™‚ã‚‚å‡¦ç†ç¶™ç¶š

#### 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- **ä¸¦è¡Œå‡¦ç†**: æœ€å¤§3æšã®ç”»åƒã‚’åŒæ™‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: URL/ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã®é‡è¤‡ç”»åƒæ¤œå‡º
- **é€²æ—è¡¨ç¤º**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çŠ¶æ³ã®ãƒ­ã‚°å‡ºåŠ›
- **ãƒ¡ãƒ¢ãƒªç®¡ç†**: å¤§é‡ç”»åƒå‡¦ç†æ™‚ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡åˆ¶å¾¡

#### 6. ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ»æ•´åˆæ€§
- **é‡è¤‡æ’é™¤**: åŒä¸€ç”»åƒã®é‡è¤‡ä¿å­˜ã‚’é˜²æ­¢
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã€å¯¸æ³•ã€å½¢å¼ã®è¨˜éŒ²
- **é–¢é€£æ€§**: ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿ã¨ã®ç´ã¥ã‘ç®¡ç†
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®è‡ªå‹•ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### 7. è¨­å®šãƒ»é‹ç”¨ç®¡ç†
- **æ©Ÿèƒ½ON/OFF**: ç”»åƒå–å¾—æ©Ÿèƒ½ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ
- **ç‰¹å®šç‰©ä»¶ç®¡ç†**: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç‰¹å®šç‰©ä»¶ä¸€è¦§ç®¡ç†
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨­å®š**: ä¿å­˜å…ˆãƒ‘ã‚¹ã®è¨­å®š
- **å®¹é‡ç›£è¦–**: ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã®ç›£è¦–ãƒ»è­¦å‘Š

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

### ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
realestate-scraper/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ scraper/
â”‚   â”‚   â”œâ”€â”€ image/                    # æ–°è¦ä½œæˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ downloader.go        # ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
â”‚   â”‚   â”‚   â”œâ”€â”€ processor.go         # ç”»åƒå‡¦ç†
â”‚   â”‚   â”‚   â””â”€â”€ storage.go           # ç”»åƒä¿å­˜ç®¡ç†
â”‚   â”‚   â””â”€â”€ used_condo_scraper.go    # ä¿®æ­£å¯¾è±¡
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â””â”€â”€ property_image.go        # æ–°è¦ä½œæˆ
â”‚   â””â”€â”€ SQL/DDL/
â”‚       â””â”€â”€ CREATE_IMAGES_TABLE.sql  # æ–°è¦ä½œæˆ
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ special_properties.go        # æ–°è¦ä½œæˆ
â”‚   â””â”€â”€ image_config.go              # æ–°è¦ä½œæˆ
â”œâ”€â”€ document/
â”‚   â””â”€â”€ design/
â”‚       â””â”€â”€ image_acquisition_design.md  # æœ¬æ–‡æ›¸
â””â”€â”€ data/
    â”œâ”€â”€ special_properties.txt        # æ–°è¦ä½œæˆ
    â””â”€â”€ images/                       # æ–°è¦ä½œæˆ
        â”œâ”€â”€ thumbnails/
        â”œâ”€â”€ main/
        â””â”€â”€ detail/
```

### ğŸ—ƒï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

#### property_images ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE property_images (
    image_id SERIAL PRIMARY KEY,
    used_condo_id INTEGER NOT NULL,
    image_type VARCHAR(20) NOT NULL,     -- 'thumbnail', 'main_list', 'detail'
    image_url VARCHAR(2048),             -- å…ƒã®SUUMOç”»åƒURL
    image_data BYTEA,                    -- ç”»åƒãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿
    image_size INTEGER,                  -- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
    width INTEGER,                       -- ç”»åƒå¹…
    height INTEGER,                      -- ç”»åƒé«˜ã•
    file_format VARCHAR(10),             -- 'jpeg', 'png', 'webp'
    quality INTEGER,                     -- ç”»åƒå“è³ªï¼ˆ1-100ï¼‰
    sort_order INTEGER,                  -- è¡¨ç¤ºé †åº
    is_main_image BOOLEAN,               -- ãƒ¡ã‚¤ãƒ³ç”»åƒãƒ•ãƒ©ã‚°
    hash_value VARCHAR(64),              -- é‡è¤‡æ¤œå‡ºç”¨ãƒãƒƒã‚·ãƒ¥
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    delete_flag BOOLEAN,
    FOREIGN KEY (used_condo_id) REFERENCES used_condos (used_condo_id)
);
```

### ğŸ”§ ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

#### 1. ImageDownloaderï¼ˆç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼‰
```go
type ImageDownloader struct {
    client     *http.Client
    config     *ImageConfig
    maxRetries int
    timeout    time.Duration
}

// ãƒ¡ã‚¤ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰
func (id *ImageDownloader) DownloadMainListImages(e *colly.HTMLElement) ([]*ImageInfo, error)
func (id *ImageDownloader) DownloadDetailImages(e *colly.HTMLElement) ([]*ImageInfo, error)
func (id *ImageDownloader) SaveImagesToDB(tx *sql.Tx, usedCondoID int, images []*ImageInfo) error
```

#### 2. SpecialPropertyManagerï¼ˆç‰¹å®šç‰©ä»¶ç®¡ç†ï¼‰
```go
type SpecialPropertyManager struct {
    properties []SpecialProperty
    filePath   string
}

// ãƒ¡ã‚¤ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰
func (spm *SpecialPropertyManager) LoadFromFile() error
func (spm *SpecialPropertyManager) IsSpecialProperty(name, url string) bool
func (spm *SpecialPropertyManager) GetSpecialProperties() []SpecialProperty
```

#### 3. ImageProcessorï¼ˆç”»åƒå‡¦ç†ï¼‰
```go
type ImageProcessor struct {
    config *ImageConfig
}

// ãƒ¡ã‚¤ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰
func (ip *ImageProcessor) ResizeImage(data []byte, maxWidth, maxHeight int) []byte
func (ip *ImageProcessor) CompressImage(data []byte, quality int) []byte
func (ip *ImageProcessor) GenerateHash(data []byte) string
```

### ğŸ“Š å‡¦ç†ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

#### mainCollectorã§ã®ç”»åƒå–å¾—ãƒ•ãƒ­ãƒ¼
```
1. ç‰©ä»¶ä¸€è¦§ãƒšãƒ¼ã‚¸ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
2. å„ç‰©ä»¶ã«ã¤ã„ã¦ï¼š
   a. ç‰©ä»¶ã®åŸºæœ¬æƒ…å ±ã‚’å–å¾—
   b. 3æšã®ç”»åƒURLã‚’æŠ½å‡º
   c. ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å‡¦ç†
   d. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
3. ç‰¹å®šç‰©ä»¶åˆ¤å®š
   a. ç‰¹å®šç‰©ä»¶ä¸€è¦§ã¨ç…§åˆ
   b. è©²å½“ã™ã‚‹å ´åˆã¯è©³ç´°ãƒšãƒ¼ã‚¸ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
```

#### detailCollectorã§ã®ç”»åƒå–å¾—ãƒ•ãƒ­ãƒ¼
```
1. ç‰©ä»¶è©³ç´°ãƒšãƒ¼ã‚¸ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
2. ç‰¹å®šç‰©ä»¶åˆ¤å®šã‚’ãƒã‚§ãƒƒã‚¯
3. ç‰¹å®šç‰©ä»¶ã®å ´åˆï¼š
   a. è©³ç´°ãƒšãƒ¼ã‚¸å†…ã®å…¨ç”»åƒURLã‚’æŠ½å‡º
   b. æ—¢å­˜ç”»åƒã¨ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
   c. æ–°è¦ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å‡¦ç†
   d. é«˜è§£åƒåº¦ç”»åƒã¨ã—ã¦ä¿å­˜
```

### ğŸ” ç”»åƒç¨®åˆ¥ãƒ»ã‚»ãƒ¬ã‚¯ã‚¿è¨­è¨ˆ

#### mainCollectorç”¨ã‚»ãƒ¬ã‚¯ã‚¿
```go
var mainListSelectors = []string{
    ".property_unit-image img",           // ãƒ¡ã‚¤ãƒ³ç”»åƒ
    ".property_unit-photo img",           // è£œåŠ©ç”»åƒ1
    ".cassetteitem_other-thumbnail img",  // è£œåŠ©ç”»åƒ2
}
```

#### detailCollectorç”¨ã‚»ãƒ¬ã‚¯ã‚¿
```go
var detailPageSelectors = map[string]string{
    "main":     ".slider-main img, .photo-main img",
    "exterior": ".photo-exterior img, [data-type='exterior'] img",
    "interior": ".photo-interior img, [data-type='interior'] img", 
    "layout":   ".photo-layout img, [data-type='layout'] img",
    "other":    ".property-photo img, .detail-images img",
}
```

### âš™ï¸ è¨­å®šç®¡ç†è¨­è¨ˆ

#### ImageConfigæ§‹é€ ä½“
```go
type ImageConfig struct {
    Enabled           bool     `json:"enabled"`             // ç”»åƒå–å¾—æ©Ÿèƒ½æœ‰åŠ¹/ç„¡åŠ¹
    MaxConcurrent     int      `json:"max_concurrent"`      // åŒæ™‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°
    RetryCount        int      `json:"retry_count"`         // ãƒªãƒˆãƒ©ã‚¤å›æ•°
    TimeoutSeconds    int      `json:"timeout_seconds"`     // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç§’æ•°
    MaxImageSize      int64    `json:"max_image_size"`      // æœ€å¤§ç”»åƒã‚µã‚¤ã‚º
    JpegQuality       int      `json:"jpeg_quality"`        // JPEGå“è³ª
    StoragePath       string   `json:"storage_path"`        // ä¿å­˜å…ˆãƒ‘ã‚¹
    EnableResize      bool     `json:"enable_resize"`       // ãƒªã‚µã‚¤ã‚ºæœ‰åŠ¹/ç„¡åŠ¹
    ThumbnailSize     [2]int   `json:"thumbnail_size"`      // ã‚µãƒ ãƒã‚¤ãƒ«ã‚µã‚¤ã‚º [å¹…, é«˜ã•]
    StandardSize      [2]int   `json:"standard_size"`       // æ¨™æº–ã‚µã‚¤ã‚º
    HighResSize       [2]int   `json:"high_res_size"`       // é«˜è§£åƒåº¦ã‚µã‚¤ã‚º
    EnableDeduplication bool   `json:"enable_deduplication"` // é‡è¤‡æ’é™¤æœ‰åŠ¹/ç„¡åŠ¹
}
```

## ğŸ“ˆ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¦ä»¶

### å®¹é‡è¨­è¨ˆ
- **å¹´é–“ç·å®¹é‡**: ç´„111GBï¼ˆç”»åƒè¾¼ã¿ï¼‰
- **æœˆé–“å¢—åŠ é‡**: ç´„9GB
- **1ç‰©ä»¶å¹³å‡**: ç´„780KBï¼ˆç”»åƒ6æšæƒ³å®šï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶
- **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é€Ÿåº¦**: å¹³å‡1MB/sä»¥ä¸Š
- **å‡¦ç†èƒ½åŠ›**: 1ç‰©ä»¶ã‚ãŸã‚Š30ç§’ä»¥å†…
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: åŒæ™‚å‡¦ç†æ™‚æœ€å¤§500MB

## ğŸš¨ ãƒªã‚¹ã‚¯ãƒ»åˆ¶ç´„äº‹é …

### æŠ€è¡“çš„åˆ¶ç´„
1. **SUUMOå´ã®åˆ¶é™**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€IPåˆ¶é™ã®å¯èƒ½æ€§
2. **ç”»åƒURLå¤‰æ›´**: SUUMOã®ç”»åƒURLæ§‹é€ å¤‰æ›´ãƒªã‚¹ã‚¯
3. **å®¹é‡åˆ¶é™**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å®¹é‡åˆ¶é™

### é‹ç”¨ä¸Šã®è€ƒæ…®äº‹é …
1. **æ³•çš„åˆ¶ç´„**: è‘—ä½œæ¨©ã€åˆ©ç”¨è¦ç´„ã®éµå®ˆ
2. **è² è·å¯¾ç­–**: SUUMOã‚µãƒ¼ãƒãƒ¼ã¸ã®è² è·è»½æ¸›
3. **ãƒ‡ãƒ¼ã‚¿ç®¡ç†**: å€‹äººæƒ…å ±ã‚’å«ã‚€ç”»åƒã®é©åˆ‡ãªç®¡ç†

## ğŸ¯ å®Ÿè£…å„ªå…ˆåº¦

### Phase 1ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰
- [x] åŸºæœ¬çš„ãªç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [x] ç‰¹å®šç‰©ä»¶ä¸€è¦§ç®¡ç†

### Phase 2ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰
- [ ] ç”»åƒå‡¦ç†ãƒ»ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- [ ] é‡è¤‡æ’é™¤æ©Ÿèƒ½

### Phase 3ï¼ˆä½å„ªå…ˆåº¦ï¼‰
- [ ] ä¸¦è¡Œå‡¦ç†æœ€é©åŒ–
- [ ] å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é€£æº
- [ ] ç®¡ç†ç”»é¢ãƒ»çµ±è¨ˆæ©Ÿèƒ½

## ğŸ“ é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸](./database_design.md)
- [APIä»•æ§˜æ›¸](./api_specification.md)
- [é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«](./operation_manual.md)